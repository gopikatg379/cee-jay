{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-danger alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    <div class="mb-4" style="background-color: #1C4D8D; color: white; padding: 12px 20px; border-radius: 6px; text-align: left; display: flex; align-items: center;">
        <h4>LR DATA</h4>
    </div>
    <form method="GET" class="card p-3 mb-4 shadow-sm">
    <div class="row g-3">

        <div class="col-md-2">
            <label>Branch</label>
            <select name="branch" class="form-select">
                <option value="all">All</option>
                {% for b in branches %}
                    <option value="{{ b.branch_id }}"
                    {% if branch_id == b.id|stringformat:"s" %}selected{% endif %}>
                        {{ b.branch_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <label >Shipper</label>
            <select name="consignor" class="form-select">
                <option value="{{ c.consignor_id }}">All</option>
                {% for c in consignors %}
                    <option value="{{ c.consignor_id }}">{{ c.consignor_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <label>Receiver</label>
            <select name="consignee" class="form-select">
                <option value="{{ c.consignee_id }}">All</option>
                {% for c in consignees %}
                    <option value="{{ c.consignee_id }}">{{ c.consignee_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-2">
            <label>Payment Type</label>
            <select name="payment_type" class="form-select">
                <option value="all">All</option>
                <option value="PAID">Paid</option>
                <option value="TOPAY">Topay</option>
                <option value="CREDIT">Credit</option>
            </select>
        </div>

        <div class="col-md-2">
            <label>From Date</label>
            <input type="date" name="from_date" value="{{ from_date }}" class="form-control" style="text-transform: uppercase;">
        </div>

        <div class="col-md-2">
            <label>To Date</label>
            <input type="date" name="to_date" value="{{ to_date }}" class="form-control" style="text-transform: uppercase;">
        </div>

        <div class="col-md-12 text-end">
            <button class="btn btn-success">Search</button>
        </div>

    </div>
</form>
<div class="card shadow-sm p-3">
<div class="table-responsive">

<table class="table table-bordered table-hover align-middle">
<div class="d-flex justify-content-end mb-3">
    <a href="{% url 'booking_excel' %}?{{ request.GET.urlencode }}"
       class="btn btn-success">
        <i class="bi bi-file-earmark-excel"></i> Download Excel
    </a>
</div>
<thead class="table-dark text-center">
<tr>
    <th>#</th>
    <th class="text-center align-middle">Date</th>
    <th class="text-center align-middle">LR No</th>
    <th class="text-center align-middle">Status</th>
    <th class="text-center align-middle">Invoice</th>
    <th class="text-center align-middle">Shipper</th>
    <th class="text-center align-middle">Receiver</th>
    <th class="text-center align-middle">Destination</th>
    <th class="text-center align-middle">Qty</th>
    <th class="text-center align-middle">Payment</th>
    <th class="text-center align-middle">Freight</th>
    <th class="text-center align-middle">LR</th>
    <th class="text-center align-middle">Pickup</th>
    <th class="text-center align-middle">Hamali</th>
    <th class="text-center align-middle">Unloading</th>
    <th class="text-center align-middle">Door Delivery</th>
    <th class="text-center align-middle">Other</th>
    <th class="text-center align-middle">Total</th>
</tr>
</thead>

<tbody>
{% for b in bookings %}
<tr>
    <td>{{ forloop.counter0|add:page_obj.start_index }}</td>
    <td>{{ b.date|date:"d-m-Y" }}</td>
    <td class="text-primary fw-semibold">{{ b.cnote_number }}</td>
    <td>{{ b.status }}</td>
    <td>{{ b.invoice_no }}</td>
    <td>{{ b.consignor.consignor_name }}</td>
    <td>{{ b.consignee.consignee_name }}</td>
    <td>{{ b.destination }}</td>
    <td class="text-end">{{ b.total_item }}</td>
    <td>{{ b.payment }}</td>
    <td class="text-end">{{ b.freight }}</td>
    <td class="text-end">{{ b.lr_charge }}</td>
    <td class="text-end">{{ b.pickup_charge }}</td>
    <td class="text-end">{{ b.hamali_charge }}</td>
    <td class="text-end">{{ b.unloading_charge }}</td>
    <td class="text-end">{{ b.door_delivery }}</td>
    <td class="text-end">{{ b.other_charge }}</td>
    <td class="text-end fw-bold">{{ b.total }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="18" class="text-center text-muted">
        No booking data found
    </td>
</tr>
{% endfor %}
</tbody>

</table>
<nav class="mt-3">
    <ul class="pagination justify-content-center">

        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link"
                   href="?page=1&{{ query_string }}">
                    First
                </a>
            </li>

            <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.previous_page_number }}&{{ query_string }}">
                    Previous
                </a>
            </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.next_page_number }}&{{ query_string }}">
                    Next
                </a>
            </li>

            <li class="page-item">
                <a class="page-link"
                   href="?page={{ page_obj.paginator.num_pages }}&{{ query_string }}">
                    Last
                </a>
            </li>
        {% endif %}

    </ul>
</nav>



</div>
</div>

</div>

{% endblock %}