{% extends "base.html" %}
{% block content %}
<style>
    .basic-info-table th,
    .basic-info-table td {
        padding: 6px 10px;
        font-size: 13px;
        vertical-align: middle;
    }

    .basic-info-table th {
        font-weight: 600;
        white-space: nowrap;
    }

    .basic-info-card .card-header {
        padding: 8px 12px;
    }

    .basic-info-card h5 {
        font-size: 14px;
        margin: 0;
    }

.timeline {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    position: relative;
    margin: 30px 0;
    padding-top: 20px;
}

.timeline::before {
    content: "";
    position: absolute;
    top: 28px;
    left: 0;
    right: 0;
    height: 3px;
    background: #dee2e6;
    z-index: 1;
}

.timeline-item {
    position: relative;
    text-align: center;
    flex: 1;
    z-index: 2;
    padding: 0 10px;
}

.timeline-dot {
    width: 18px;
    height: 18px;
    margin: 0 auto 8px;
    border-radius: 50%;
    background: #dee2e6;
}

.timeline-item.completed .timeline-dot {
    background: #198754;
}

.timeline-status {
    font-weight: 600;
    font-size: 13px;
}

.timeline-meta {
    font-size: 11px;
    color: #6c757d;
    margin-top: 4px;
}
@media (max-width: 768px) {
    .timeline {
        overflow-x: auto;
        white-space: nowrap;
    }

    .timeline-item {
        min-width: 200px;
    }
}
    
</style>

{% load tz %}
<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">Basic Info – LR No: {{ cnote.cnote_number }}</h3>
         <div class="d-flex align-items-center gap-3">

        <a href="#" 
           data-bs-toggle="modal" 
           data-bs-target="#ratesModal"
           class="fw-semibold text-primary text-decoration-none">
            Rates
        </a>

        <a href="{% url 'print_cnote' cnote.pk %}" 
           target="_blank" 
           class="btn btn-info btn-sm">
            <i class="bi bi-printer"></i> Print LR
        </a>

    </div>
    </div>

    <div class="card shadow-sm border-0 basic-info-card">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Basic Info </h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-bordered mb-0 basic-info-table">
                    <tbody>
                        <tr>
                            <th width="20%" class="bg-light">LR NO.</th>
                            <td>{{ cnote.cnote_number }}</td>
                            <th class="bg-light">LR DATE</th>
                            <td>{{ cnote.date|date:"d-m-Y" }}</td>
                        </tr>
                        <tr>
                            <th class="bg-light">CONSIGNOR</th>
                            <td>{{ cnote.consignor.consignor_name|default:"-" }}</td>
                            <th class="bg-light">CONSIGNEE</th>
                            <td>{{ cnote.consignee.consignee_name|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th class="bg-light">DESTINATION</th>
                            <td>{{ cnote.destination.location_name|default:"-" }}</td>
                            <th class="bg-light">TOTAL QUANTITY</th>
                            <td>{{ cnote.total_item|default:"1" }}</td>
                        </tr>
                        <tr>
                            <th class="bg-light">DELIVERY BRANCH</th>
                            <td>{{cnote.delivery_branch}}</td>
                            <th class="bg-light">DISTRICT</th>
                            <td>{{cnote.destination.district}}</td>
                        </tr>
                        <tr>
                            <th class="bg-light">PAYMENT TYPE</th>
                            <td>To Pay</td>
                            <th class="bg-light">CURRENT STATUS</th>
                            <td>
                                <span class="badge bg-success">{{cnote.status}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
<div class="card mt-4 shadow-sm">
    <div class="card-header bg-light">
        <strong>Tracking Details</strong>
    </div>

    <div class="card-body">
        <div class="timeline">

    <div class="timeline-item completed">
        <div class="timeline-dot"></div>
        <div class="timeline-content">
            <div class="timeline-status">Booked</div>
            <div class="timeline-meta">
                {{ cnote.booking_branch.branch_name }} <br>
                logged in : {{ cnote.user.username }} <br>
                {{ cnote.created_at|date:"d-m-Y H:i" }}
            </div>
        </div>
    </div>

    {% for t in trackings %}
    <div class="timeline-item completed">
        <div class="timeline-dot"></div>
        <div class="timeline-content">
            <div class="timeline-status">
                {% if t.status|upper == "RECEIVED" %}
                    ARRIVED AT
                {% elif t.status|upper == "SHIPPED" %}
                    SHIPPED TO
                {% elif t.status|upper == "OUT FOR DELIVERY" %}
                    OUT FOR DELIVERY<br/>
                <a href="{% url 'manifest_print' t.cnote.manifest.manifest_id %}">DRS/{{t.cnote.manifest.from_branch.branch_shortname}}/{{t.cnote.manifest.manifest_number}}</a>
                {% elif t.status|upper == "RETURNED" %}
                RETURN <br>(Delivery not complete)<br/>
                <a href="{% url 'manifest_print' t.cnote.manifest.manifest_id %}"">DRS/{{t.cnote.manifest.from_branch.branch_shortname}}/{{t.cnote.manifest.manifest_number}}</a>
                {% else %}
                    {{ t.status }}
                {% endif %}
            </div>

            <div class="timeline-meta">
                {{ t.branch.branch_name }} <br>
                logged in : {{ t.created_by.username }} <br>
                {{ t.created_at|date:"d-m-Y H:i" }}
            </div>
        </div>
    </div>
    {% endfor %}

</div>

    </div>
</div>

    <div class="mt-4">
        <a href="{% url 'cnote_list' %}" class="btn btn-secondary">
            ← Back to List
        </a>
    </div>

</div>
<div class="modal fade" id="ratesModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title">LR Rate Details</h5>
                <button type="button" class="btn-close btn-close-white" 
                        data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <table class="table table-bordered table-sm">
                    <tbody>
                        <tr>
                            <th width="30%">Freight</th>
                            <td>{{ cnote.freight|default:"0.00" }}</td>
                        </tr>

                        <tr>
                            <th>LR Charge</th>
                            <td>{{ cnote.lr_charge|default:"0.00" }}</td>
                        </tr>

                        <tr>
                            <th>Door Delivery Charge</th>
                            <td>{{ cnote.door_delivery|default:"0.00" }}</td>
                        </tr>

                        <tr>
                            <th>Unloading Charge</th>
                            <td>{{ cnote.unloading_charge|default:"0.00" }}</td>
                        </tr>

                        <tr>
                            <th>Hamali Charges</th>
                            <td>{{ cnote.hamali_charge|default:"0.00" }}</td>
                        </tr>

                        <tr>
                            <th>Other Charges</th>
                            <td>{{ cnote.other_charge|default:"0.00" }}</td>
                        </tr>

                        <tr class="table-success">
                            <th>Total Amount</th>
                            <td><strong>{{ cnote.total|default:"0.00" }}</strong></td>
                        </tr>
                    </tbody>
                </table>

            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary btn-sm" 
                        data-bs-dismiss="modal">
                    Close
                </button>
            </div>

        </div>
    </div>
</div>
{% endblock %}